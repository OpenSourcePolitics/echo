_shared_config:
  directusHost: &directusHost directus.echo.CHANGE_ME.COM
  apiHost: &apiHost api.echo.CHANGE_ME.COM
  frontendHost: &frontendHost echo.CHANGE_ME.COM
  adminHost: &adminHost dashboard.echo.CHANGE_ME.COM
  participantHost: &participantHost portal.echo.CHANGE_ME.COM
  apiUrl: &apiUrl https://api.echo.CHANGE_ME.COM
  frontendUrl: &frontendUrl https://echo.CHANGE_ME.COM
  directusPublicUrl: &directusPublicUrl https://directus.echo.CHANGE_ME.COM
  adminBaseUrl: &adminBaseUrl https://dashboard.echo.CHANGE_ME.COM
  participantBaseUrl: &participantBaseUrl https://portal.echo.CHANGE_ME.COM
  redisUrl: &redisUrl "redis://echo-redis:6379"
  database:
    databaseUsername: &databaseUsername "CHANGE_ME"
    databasePassword: &databasePassword "CHANGE_ME_PASSWORD"
    databaseName: &databaseName "echo"
    databaseUrl: &databaseUrl "postgresql://CHANGE_ME:CHANGE_ME_PASSWORD@CHANGE_ME:5432/echo"
    databaseUrlPsycoPg: &databaseUrlPsycoPg "postgresql+psycopg://CHANGE_ME:CHANGE_ME_PASSWORD@CHANGE_ME:5432/echo"
  rabbitmq:
    rabbitmqUsername: &rabbitmqUsername "CHANGE_ME"
    rabbitmqPassword: &rabbitmqPassword "CHANGE_ME_PASSWORD"
    rabbitmqUrl: &rabbitmqUrl "amqp://CHANGE_ME:CHANGE_ME_PASSWORD@echo-rabbitmq:5672"
  directus:
    auth:
      googleClientId: &googleClientId "a"
      googleClientSecret: &googleClientSecret "a"
    directusCookieName: &directusCookieName "directus_session_token"
    directusCookieDomain: &directusCookieDomain ".echo.CHANGE_ME.COM"
    directusMarketplaceTrust: &directusMarketplaceTrust "all"
    directusAdminEmail: &directusAdminEmail ""
    directusAdminPassword: &directusAdminPassword ""
    directusAdminToken: &directusAdminToken ""
    directusEmailFrom: &directusEmailFrom ""
    directusEmailSmtpHost: &directusEmailSmtpHost ""
    directusEmailSmtpUser: &directusEmailSmtpUser ""
    directusEmailSmtpPassword: &directusEmailSmtpPassword ""
    directusEmailSmtpPort: &directusEmailSmtpPort ""
    directusEmailSmtpSecure: &directusEmailSmtpSecure "false"
    directusEmailVerifySetup: &directusEmailVerifySetup "true"
    directusSecret: &directusSecret ""
    directusUserRegisterAllowList: &directusUserRegisterURLAllowList "https://dashboard.echo.CHANGE_ME.COM/verify-email"
    directusPasswordResetAllowList: &directusPasswordResetURLAllowList "https://dashboard.echo.CHANGE_ME.COM/password-reset"
    directusUserInviteAllowList: &directusUserInviteURLAllowList "https://dashboard.echo.CHANGE_ME.COM/invite"

  apiServer:
    buildVersion: "1.0.0"
    openaiApiKey: &openaiApiKey "CHANGE_ME"
    anthropicApiKey: &anthropicApiKey "CHANGE_ME"
    corsOrigins: &corsOrigins "https://localhost:8888,https://localhost:3000"
  s3:
    bucketName: &bucketName "dembrane"
    bucketRegion: &bucketRegion "fr-par"
    bucketEndpoint: &bucketEndpoint "https://CHANGE_ME"
    bucketKey: &bucketKey "CHANGE_ME"
    bucketSecret: &bucketSecret "CHANGE_ME"
global:
  imageTag: "1.0.0"
  registry: "rg.fr-par.scw.cloud/dembrane"
  redisUrl: *redisUrl

directus:
  replicaCount: 2
  image:
    repository: "rg.fr-par.scw.cloud/dembrane/dbr-echo-directus"
    tag: "1.0.2"
  service:
    port: 8055
  env:
    SESSION_COOKIE_NAME: *directusCookieName
    PUBLIC_URL: *directusPublicUrl
    PORT: "8055"
    WEBSOCKETS_ENABLED: "true"
    DB_CLIENT: "pg"
    DB_DATABASE: *databaseName
    TELEMETRY: "false"
    REDIS_ENABLED: "true"
    CORS_ENABLED: "true"
    CORS_ORIGIN: *corsOrigins
    CORS_CREDENTIALS: "true"
    SESSION_COOKIE_SAME_SITE: "None"
    SESSION_COOKIE_SECURE: "true"
    SESSION_COOKIE_DOMAIN: *directusCookieDomain
    EMAIL_TRANSPORT: "smtp"
    AUTH_GOOGLE_CLIENT_ID: *googleClientId
    AUTH_GOOGLE_CLIENT_SECRET: *googleClientSecret
    ADMIN_EMAIL: *directusAdminEmail
    DIRECTUS_ADMIN_PASSWORD: *directusAdminPassword
    DIRECTUS_ADMIN_TOKEN: *directusAdminToken
    DIRECTUS_EMAIL_FROM: *directusEmailFrom
    DIRECTUS_EMAIL_SMTP_HOST: *directusEmailSmtpHost
    DIRECTUS_EMAIL_SMTP_USER: *directusEmailSmtpUser
    DIRECTUS_EMAIL_SMTP_PASSWORD: *directusEmailSmtpPassword
    DIRECTUS_EMAIL_SMTP_PORT: *directusEmailSmtpPort
    DIRECTUS_EMAIL_VERIFY_SETUP: *directusEmailVerifySetup
    DIRECTUS_EMAIL_SMTP_SECURE: *directusEmailSmtpSecure
    DIRECTUS_SECRET: *directusSecret
    DIRECTUS_MARKETPLACE_TRUST: *directusMarketplaceTrust
    USER_REGISTER_URL_ALLOW_LIST: *directusUserRegisterURLAllowList
    PASSWORD_RESET_URL_ALLOW_LIST: *directusPasswordResetURLAllowList
    USER_INVITE_URL_ALLOW_LIST: *directusUserInviteURLAllowList

apiServer:
  replicaCount: 1
  image:
    repository: "rg.fr-par.scw.cloud/dembrane/dbr-server"
    tag: "1.0.6"
  service:
    port: 8000
  env:
    ADMIN_BASE_URL: *adminBaseUrl
    PARTICIPANT_BASE_URL: *participantBaseUrl
    BUILD_VERSION: "1.0.0"
    DISABLE_REDACTION: "1"
    DISABLE_SENTRY: "1"
    SERVE_API_DOCS: "1"
    ANTHROPIC_API_KEY: *anthropicApiKey
    DATABASE_URL: *databaseUrl
    DATABASE_URL_WORKER: *databaseUrlPsycoPg
    OPENAI_API_KEY: *openaiApiKey
    REDIS_URL: *redisUrl
    RABBITMQ_URL: *rabbitmqUrl
    DIRECTUS_PUBLIC_URL: *directusPublicUrl
    DIRECTUS_SECRET: *directusSecret
    DIRECTUS_TOKEN: *directusAdminToken
    DIRECTUS_SESSION_COOKIE_NAME: *directusCookieName
    DISABLE_CORS: "false"
    STORAGE_S3_BUCKET: *bucketName
    STORAGE_S3_REGION: *bucketRegion
    STORAGE_S3_ENDPOINT: *bucketEndpoint
    STORAGE_S3_KEY: *bucketKey
    STORAGE_S3_SECRET: *bucketSecret

worker:
  replicaCount: 1
  image:
    repository: "rg.fr-par.scw.cloud/dembrane/dbr-server"
    tag: "1.0.6"
  env:
    DIRECTUS_PUBLIC_URL: *directusPublicUrl
    DIRECTUS_SECRET: *directusSecret
    DIRECTUS_TOKEN: *directusAdminToken
    DIRECTUS_SESSION_COOKIE_NAME: *directusCookieName
    ADMIN_BASE_URL: *adminBaseUrl
    PARTICIPANT_BASE_URL: *participantBaseUrl
    DATABASE_URL: *databaseUrl
    OPENAI_API_KEY: *openaiApiKey
    ANTHROPIC_API_KEY: *anthropicApiKey
    REDIS_URL: *redisUrl
    BUILD_VERSION: "1.0.0"
    DISABLE_REDACTION: "1"
    DISABLE_SENTRY: "1"
    SERVE_API_DOCS: "0"
    DISABLE_CORS: "false"
    STORAGE_S3_BUCKET: *bucketName
    STORAGE_S3_REGION: *bucketRegion
    STORAGE_S3_ENDPOINT: *bucketEndpoint
    STORAGE_S3_KEY: *bucketKey
    STORAGE_S3_SECRET: *bucketSecret

ingress:
  enabled: true
  className: "nginx"
  hosts:
    directus: *directusHost
    api: *apiHost
    frontend: *frontendHost
    dashboard: *adminHost
    participant: *participantHost
  tls:
    - secretName: "echo-tls"
      hosts:
        - *directusHost
        - *apiHost
        - *frontendHost
        - *adminHost
        - *participantHost

postgresql:
  enabled: false
  image:
    repository: pgvector/pgvector
    tag: "pg16"
  postgresqlUsername: *databaseUsername
  postgresqlPassword: *databasePassword
  postgresqlDatabase: *databaseName
  service:
    type: ClusterIP
    port: 5432
  persistence:
    enabled: true
    size: 3Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

redis:
  enabled: true
  image:
    repository: redis
    tag: "7"
  service:
    type: ClusterIP
    port: 6379
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

rabbitmq:
  enabled: true
  image:
    repository: rabbitmq
    tag: "3.11-management"
  service:
    type: ClusterIP
    port: 5672
    managementPort: 15672
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m
  username: *rabbitmqUsername
  password: *rabbitmqPassword

frontend:
  enabled: true
  image:
    repository: "rg.fr-par.scw.cloud/dembrane/dbr-frontend"
    tag: "1.0.11"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 5173
  env:
    VITE_BUILD_VERSION: "1.0.0"
    VITE_API_BASE_URL: *apiUrl
    VITE_ADMIN_BASE_URL: *adminBaseUrl
    VITE_PARTICIPANT_BASE_URL: *participantBaseUrl
    VITE_USE_PARTICIPANT_ROUTER: "0"
    VITE_DIRECTUS_PUBLIC_URL: *directusPublicUrl
    VITE_DIRECTUS_CONTENT_PUBLIC_URL: *directusPublicUrl
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

participant:
  enabled: true
  image:
    repository: "rg.fr-par.scw.cloud/dembrane/dbr-participant"
    tag: "1.0.11"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 5173
  env:
    VITE_USE_PARTICIPANT_ROUTER: "1"
    VITE_BUILD_VERSION: "1.0.0"
    VITE_API_BASE_URL: *apiUrl
    VITE_ADMIN_BASE_URL: *adminBaseUrl
    VITE_PARTICIPANT_BASE_URL: *participantBaseUrl
    VITE_DIRECTUS_PUBLIC_URL: *directusPublicUrl
    VITE_DIRECTUS_CONTENT_PUBLIC_URL: *directusPublicUrl
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m